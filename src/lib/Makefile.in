srcdir = @srcdir@
VPATH = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@

CC = @CC@
INSTALL = @INSTALL@

MAJOR_LIB_VERSION = 0
MINOR_LIB_VERSION = 10

INCLUDES = -I../include 

CFLAGS =  @CFLAGS@ $(INCLUDES) 

IPCOBJS = mwclientipcapi.o ipctables.o ipcmessages.o mwserverapi.o shmalloc.o osdep.o

NETOBJS = SRBclient.o SRBprotocol.o multicast.o

COMMONOBJS = mwlog.o version.o address.o mwclientapi.o

LIBS = libMidWay.a libMidWay.so.$(MAJOR_LIB_VERSION).$(MINOR_LIB_VERSION)

all: $(LIBS) testmidway

clean: 
	rm -f $(LIBS) $(IPCOBJS) $(COMMONOBJS) $(NETOBJS) testmidway core 

distclean:
	rm -f Makefile *~

install:
	$(INSTALL) libMidWay.so @libdir@/libMidWay.so.0.10
	ln -f -s libMidWay.so.0.10 @libdir@/libMidWay.so.0
	ln -f -s libMidWay.so.0.10 @libdir@/libMidWay.so
	$(INSTALL) -m 644 libMidWay.a @libdir@/libMidWay.a

uninstall:
	rm -f @libdir@/libMidWay.so*
	rm -f @libdir@/libMidWay.a

tags:
	etags -a -o ../TAGS *.c *.h

depend:
	makedepend -- $(CFLAGS) -- *.c

libMidWay.a: $(IPCOBJS) $(COMMONOBJS) $(NETOBJS)  
	ar qcs $@ $(IPCOBJS) $(COMMONOBJS) $(NETOBJS) 

libMidWay.so.$(MAJOR_LIB_VERSION).$(MINOR_LIB_VERSION): $(IPCOBJS) $(COMMONOBJS) $(NETOBJS) 
	$(CC) -shared -Wl,-soname,libMidWay.so.$(MAJOR_LIB_VERSION) -o $@ $(IPCOBJS) $(COMMONOBJS) $(NETOBJS) ../liburlencode/liburlencode.a -lm 
	ln -f -s libMidWay.so.$(MAJOR_LIB_VERSION).$(MINOR_LIB_VERSION) libMidWay.so.$(MAJOR_LIB_VERSION)
	ln -f -s libMidWay.so.$(MAJOR_LIB_VERSION).$(MINOR_LIB_VERSION) libMidWay.so

#	ld -Bshareable -g -o $@ $(IPCOBJS) $(COMMONOBJS)

testmidway: testmidway.c ../include/MidWay.h libMidWay.a
	$(CC) -o $@ testmidway.c -I../include -L. -lMidWay 

